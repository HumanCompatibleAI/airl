sudo: required
dist: xenial

language: python
cache: pip
before_install:
  - sudo apt-get install -y libopenmpi-dev
install:
  - pip install -r requirements.txt
  - pip install .
script:
  - pytest -vv tests/

matrix:
  include:
  - name: "Linting"
    python: "3.7"
    install:
      - pip install -r requirements.txt
      - pip install -r requirements-dev.txt
      - pip install .
    script:
      - ci/lint.sh

  - name: "3.7 Coverage Tests"
    python: "3.7"
    install:
      - pip install -r requirements.txt
      # Install in developer mode so codecov can match paths
      - pip install -e .
    script:
      - py.test -vv --cov-report=xml --cov=. tests/
    after_success:
      - codecov

  - name: "3.7 Static Type Checking"
    python: "3.7"
    install:
      - pip install -r requirements.txt
      - pip install .
      - pip install pytype
    script:
      - ci/type_check.sh

  - name: "3.6 Unit Tests"
    python: "3.6"
  - name: "3.7 Unit Tests"
    python: "3.7"
